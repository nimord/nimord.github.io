<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>LFCS 01：如何在 Linux 上使用 GNU sed 等命令来创建、编辑和操作文件 | ChaoS</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LFCS 01：如何在 Linux 上使用 GNU sed 等命令来创建、编辑和操作文件</h1><a id="logo" href="/.">ChaoS</a><p class="description">似于混沌</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LFCS 01：如何在 Linux 上使用 GNU sed 等命令来创建、编辑和操作文件</h1><div class="post-meta">Jul 29, 2016<span> | </span><span class="category"><a href="/categories/转载/">转载</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h3 id="处理-Linux-中的文本流"><a href="#处理-Linux-中的文本流" class="headerlink" title="处理 Linux 中的文本流"></a>处理 Linux 中的文本流</h3><p>Linux 将程序中的输入和输出当成字符流或者字符序列。在开始理解重定向和管道之前，我们必须先了解三种最重要的I/O（输入和输出Input and Output）流，事实上，它们都是特殊的文件（根据 UNIX 和 Linux 中的约定，数据流和外围设备（设备文件）也被视为普通文件）。</p>
<p>在 &gt; (重定向操作符) 和 | (管道操作符)之间的区别是：前者将命令与文件相连接，而后者将命令的输出和另一个命令相连接。</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr"># command &gt; file# command1</span> | comma<span class="symbol">nd2</span></span><br></pre></td></tr></table></figure>
<p>由于重定向操作符会静默地创建或覆盖文件，我们必须特别小心谨慎地使用它，并且永远不要把它和管道混淆起来。在 Linux 和 UNIX 系统上管道的优势是：第一个命令的输出不会写入一个文件而是直接被第二个命令读取。</p>
<p>在下面的操作练习中，我们将会使用这首诗——《A happy child》（作者未知)</p>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055317sx248jjs2c4c7uu7.png" alt="cat 命令样例"></p>
<p><em>cat 命令样例</em></p>
<h4 id="使用-sed"><a href="#使用-sed" class="headerlink" title="使用 sed"></a>使用 sed</h4><p>sed 是流编辑器stream editor的缩写。为那些不懂术语的人额外解释一下，流编辑器是用来在一个输入流（文件或者管道中的输入）执行基本的文本转换的工具。</p>
<p>sed 最基本的用法是字符替换。我们将通过把每个出现的小写 y 改写为大写 Y 并且将输出重定向到 ahappychild2.txt 开始。g 标志表示 sed 应该替换文件每一行中所有应当替换的实例。如果这个标志省略了，sed 将会只替换每一行中第一次出现的实例。</p>
<p><strong>基本语法：</strong></p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># sed <span class="string">'s/term/replacement/flag'</span> file</span></span><br></pre></td></tr></table></figure>
<p><strong>我们的样例：</strong></p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># sed <span class="string">'s/y/Y/g'</span> ahappychild.txt &gt; ahappychild2.txt</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055318u6w915x3w6gg64l5.png" alt="sed 命令样例"></p>
<p><em>sed 命令样例</em></p>
<p>如果你要在替换文本中搜索或者替换特殊字符（如 /，\，＆），你需要使用反斜杠对它进行转义。</p>
<p>例如，我们要用一个符号来替换一个文字，与此同时我们将把一行最开始出现的第一个 I 替换为 You。</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sed <span class="symbol">'s</span>/<span class="keyword">and</span>/\&amp;/g;s/^<span class="type">I</span>/<span class="type">You</span>/g' ahappychild.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055318ustph1gt8asgs2t8.png" alt="sed 替换字符串"></p>
<p><em>sed 替换字符串</em></p>
<p>在上面的命令中，众所周知 ^（插入符号）是正则表达式中用来表示一行开头的符号。</p>
<p>正如你所看到的，我们可以通过使用分号分隔以及用括号包裹来把两个或者更多的替换命令（并在它们中使用正则表达式）连接起来。</p>
<p>另一种 sed 的用法是显示或者删除文件中选中的一部分。在下面的样例中，将会显示 /var/log/messages 中从6月8日开始的头五行。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sed -<span class="keyword">n</span> '/^Jun  8/ p' /<span class="keyword">var</span>/<span class="keyword">log</span>/messages | sed -<span class="keyword">n</span> 1,5p</span><br></pre></td></tr></table></figure>
<p>请注意，在默认的情况下，sed 会打印每一行。我们可以使用 -n 选项来覆盖这一行为并且告诉 sed 只需要打印（用 p来表示）文件（或管道）中匹配的部分（第一个命令中指定以“Jun 8” 开头的行，第二个命令中指定一到五行）。</p>
<p>最后，可能有用的技巧是当检查脚本或者配置文件的时候可以保留文件本身并且删除注释。下面的单行 sed 命令删除（d）空行或者是开头为<code>#</code>的行（| 字符对两个正则表达式进行布尔 OR 操作）。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># sed <span class="string">'/^#\|^$/d'</span> apache2.conf</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055318sz9c1jpnjqnacl1p.png" alt="sed 匹配字符串"></p>
<p><em>sed 匹配字符串</em></p>
<h4 id="uniq-命令"><a href="#uniq-命令" class="headerlink" title="uniq 命令"></a>uniq 命令</h4><p>uniq 命令允许我们返回或者删除文件中重复的行，默认写到标准输出。我们必须注意到，除非两个重复的行相邻，否则uniq 命令不会删除他们。因此，uniq 经常和一个前置的 sort 命令（一种用来对文本行进行排序的算法）搭配使用。默认情况下，sort 使用第一个字段（用空格分隔）作为关键字段。要指定一个不同的关键字段，我们需要使用 -k 选项。</p>
<p><strong>样例</strong></p>
<p>du –sch /path/to/directory/* 命令将会以人类可读的格式返回在指定目录下每一个子文件夹和文件的磁盘空间使用情况（也会显示每个目录总体的情况），而且不是按照大小输出，而是按照子文件夹和文件的名称。我们可以使用下面的命令来让它通过大小排序。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># du -sch <span class="regexp">/var/</span>* | <span class="keyword">sort</span> -h</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055319qckggebd272dhhe2.jpg" alt="sort 命令样例"></p>
<p><em>sort 命令样例</em></p>
<p>你可以通过使用下面的命令告诉 uniq 比较每一行的前6个字符（-w 6）（这里是指定的日期）来统计日志事件的个数，而且在每一行的开头输出出现的次数（-c）。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">cat</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/mail.<span class="keyword">log</span> | uniq -c -w 6</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055319ex1ex1hxjmnywnbm.jpg" alt="文件中的统计数字"></p>
<p><em>文件中的统计数字</em></p>
<p>最后，你可以组合使用 sort 和 uniq 命令（通常如此）。看看下面文件中捐助者、捐助日期和金额的列表。假设我们想知道有多少个捐助者。我们可以使用下面的命令来分隔第一字段（字段由冒号分隔），按名称排序并且删除重复的行。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">cat</span> sortuniq.txt | cut -<span class="keyword">d</span>: -f1 | <span class="keyword">sort</span> | uniq</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055320quba70a7m8vbe4ym.jpg" alt="寻找文件中不重复的记录"></p>
<p><em>寻找文件中不重复的记录</em></p>
<ul>
<li>也可阅读: <a href="https://linux.cn/article-2336-1.html" target="_blank" rel="external">13个“cat”命令样例</a></li>
</ul>
<h4 id="grep-命令"><a href="#grep-命令" class="headerlink" title="grep 命令"></a>grep 命令</h4><p>grep 在文件（或命令输出）中搜索指定正则表达式，并且在标准输出中输出匹配的行。</p>
<p><strong>样例</strong></p>
<p>显示文件 /etc/passwd 中用户 gacanepa 的信息，忽略大小写。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">grep</span> -i gacanepa <span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055320eepm9mp9mm4qwe9e.jpg" alt="grep 命令样例"></p>
<p><em>grep 命令样例</em></p>
<p>显示 /etc 文件夹下所有 rc 开头并跟随任意数字的内容。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">ls</span> -<span class="keyword">l</span> /etc | grep rc[0-9]</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055321o4y33j3zzk3k4jpk.jpg" alt="使用 grep 列出内容"></p>
<p><em>使用 grep 列出内容</em></p>
<ul>
<li>也可阅读: <a href="https://linux.cn/article-2250-1.html" target="_blank" rel="external">12个“grep”命令样例</a></li>
</ul>
<h4 id="tr-命令使用技巧"><a href="#tr-命令使用技巧" class="headerlink" title="tr 命令使用技巧"></a>tr 命令使用技巧</h4><p>tr 命令可以用来从标准输入中转换（改变）或者删除字符，并将结果写入到标准输出中。</p>
<p><strong>样例</strong></p>
<p>把 sortuniq.txt 文件中所有的小写改为大写。</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat sortuniq.txt | tr <span class="string">[:lower:]</span> <span class="string">[:upper:]</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055321tjh2huac2yxxhx29.jpg" alt="排序文件中的字符串"></p>
<p><em>排序文件中的字符串</em></p>
<p>压缩<code>ls –l</code>输出中的分隔符为一个空格。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">ls</span> -<span class="keyword">l</span> | <span class="keyword">tr</span> -s <span class="string">' '</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055321hz2w9e42egucz2iu.jpg" alt="压缩分隔符"></p>
<p><em>压缩分隔符</em></p>
<h4 id="cut-命令使用方法"><a href="#cut-命令使用方法" class="headerlink" title="cut 命令使用方法"></a>cut 命令使用方法</h4><p>cut 命令可以基于字节（-b选项）、字符（-c）或者字段（-f）提取部分输入（从标准输入或者文件中）并且将结果输出到标准输出。在最后一种情况下（基于字段），默认的字段分隔符是一个制表符，但可以由 -d 选项来指定不同的分隔符。</p>
<p><strong>样例</strong></p>
<p>从 /etc/passwd 中提取用户账户和他们被分配的默认 shell（-d 选项允许我们指定分界符，-f 选项指定那些字段将被提取）。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">cat</span> /etc/passwd | cut -<span class="keyword">d</span>: -f1,7</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055322pgyrzp6irfm299fj.jpg" alt="提取用户账户"></p>
<p><em>提取用户账户</em></p>
<p>将以上命令结合起来，我们将使用 last 命令的输出中第一和第三个非空文件创建一个文本流。我们将使用 grep 作为第一过滤器来检查用户 gacanepa 的会话，然后将分隔符压缩至一个空格（tr -s ‘ ‘)。下一步，我们将使用 cut 来提取第一和第三个字段，最后使用第二个字段（本样例中，指的是IP地址）来排序之后，再用 uniq 去重。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">last</span> | <span class="keyword">grep</span> gacanepa | <span class="keyword">tr</span> -s ‘ ‘ | cut -d’ ‘ -f1,<span class="number">3</span> | <span class="keyword">sort</span> -k2 | uniq</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201603/28/055322bio7q6dxhoioeo6q.png" alt="last 命令样例"></p>
<p><em>last 命令样例</em></p>
<p>上面的命令显示了如何将多个命令和管道结合起来，以便根据我们的要求得到过滤后的数据。你也可以逐步地使用它以帮助你理解输出是如何从一个命令传输到下一个命令的（顺便说一句，这是一个非常好的学习经验！）</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://nimord.github.io/2016/07/29/lfcs-01/" data-id="ciy31le43000620awpgdci3bm" class="article-share-link">分享到</a><div class="tags"><a href="/tags/lfcs/">lfcs</a></div><div class="post-nav"><a href="/2016/07/29/lfcs-02/" class="pre">LFCS 02：如何安装和使用纯文本编辑器 vi/vim</a><a href="/2016/05/20/orientation-is-more-important-than-hardwork/" class="next">方向选择和埋头苦干</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://nimord.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/lfcs/" style="font-size: 15px;">lfcs</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-12/">LFCS 12：如何使用 Linux 的帮助文档和工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-11/">LFCS 11：如何使用命令 vgcreate、lvcreate 和 lvextend 管理和创建 LVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-10/">LFCS 10：学习简单的 Shell 脚本编程和文件系统故障排除</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-09/">LFCS 09：使用 Yum/RPM/Apt/Dpkg/Aptitude 进行 Linux 软件包管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-08/">LFCS 08：管理用户和用户组、文件权限和属性以及启用账户 sudo 访问权限</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-07/">LFCS 07：通过 SysVinit、Systemd 和 Upstart 管理系统自启动进程和服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-06/">LFCS 06：组装分区为RAID设备——创建和管理系统备份</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-05/">LFCS 05：如何在 Linux 中挂载/卸载本地文件系统和网络文件系统（Samba 和 NFS）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-04/">LFCS 04：对存储设备分区、格式化文件系统和配置交换分区</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-03/">LFCS 03：归档/压缩文件及目录、设置文件属性和搜索文件</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">ChaoS.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>