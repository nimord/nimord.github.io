<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>LFCS 06：组装分区为RAID设备——创建和管理系统备份 | ChaoS</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LFCS 06：组装分区为RAID设备——创建和管理系统备份</h1><a id="logo" href="/.">ChaoS</a><p class="description">似于混沌</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LFCS 06：组装分区为RAID设备——创建和管理系统备份</h1><div class="post-meta">Jul 29, 2016<span> | </span><span class="category"><a href="/categories/转载/">转载</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/07/29/lfcs-06/" href="/2016/07/29/lfcs-06/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h3 id="了解RAID"><a href="#了解RAID" class="headerlink" title="了解RAID"></a>了解RAID</h3><p>这种被称为独立磁盘冗余阵列（Redundant Array of Independent Disks）(RAID)的技术是将多个硬盘组合成一个单独逻辑单元的存储解决方案，它提供了数据冗余功能并且改善硬盘的读写操作性能。</p>
<p>然而，实际的容错和磁盘 I/O 性能硬盘取决于如何将多个硬盘组装成磁盘阵列。根据可用的设备和容错/性能的需求，RAID 被分为不同的级别，你可以参考 RAID 系列文章以获得每个 RAID 级别更详细的解释。</p>
<ul>
<li><a href="https://linux.cn/article-6085-1.html" target="_blank" rel="external">在 Linux 下使用 RAID（一）：介绍 RAID 的级别和概念</a></li>
</ul>
<p>我们选择用于创建、组装、管理、监视软件 RAID 的工具，叫做 mdadm (multiple disk admin 的简写）。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">Debian</span> <span class="comment">及衍生版</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">#</span> <span class="comment">aptitude</span> <span class="comment">update</span> <span class="comment">&amp;&amp;</span> <span class="comment">aptitude</span> <span class="comment">install</span> <span class="comment">mdadm</span></span><br></pre></td></tr></table></figure>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">Red</span> <span class="comment">Hat</span> <span class="comment">和基于</span> <span class="comment">CentOS</span> <span class="comment">的系统</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">#</span> <span class="comment">yum</span> <span class="comment">update</span> <span class="comment">&amp;&amp;</span> <span class="comment">yum</span> <span class="comment">install</span> <span class="comment">mdadm</span></span><br></pre></td></tr></table></figure>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">openSUSE</span> <span class="comment">上</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">#</span> <span class="comment">zypper</span> <span class="comment">refresh</span> <span class="comment">&amp;&amp;</span> <span class="comment">zypper</span> <span class="comment">install</span> <span class="comment">mdadm</span> <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h4 id="将分区组装成-RAID-设备"><a href="#将分区组装成-RAID-设备" class="headerlink" title="将分区组装成 RAID 设备"></a>将分区组装成 RAID 设备</h4><p>组装已有分区作为 RAID 设备的过程由以下步骤组成。</p>
<p><strong>1. 使用 mdadm 创建阵列</strong></p>
<p>如果先前其中一个分区已经格式化，或者作为了另一个 RAID 阵列的一部分，你会被提示以确认创建一个新的阵列。假设你已经采取了必要的预防措施以避免丢失重要数据，那么可以安全地输入 Y 并且按下回车。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">verbose</span> <span class="comment">/dev/md0</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">level=stripe</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raid</span><span class="literal">-</span><span class="comment">devices=2</span> <span class="comment">/dev/sdb1</span> <span class="comment">/dev/sdc1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222344q1889bbk5n869592.png" alt="创建 RAID 阵列"></p>
<p><em>创建 RAID 阵列</em></p>
<p><strong>2. 检查阵列的创建状态</strong></p>
<p>在创建了 RAID 阵列之后，你可以检查使用以下命令检查阵列的状态。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat <span class="regexp">/proc/m</span>dstator# mdadm --detail <span class="regexp">/dev/m</span>d0    [More detailed summary]</span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222348pxren45x9z57pzbu.png" alt="检查 RAID 阵列的状态"></p>
<p><em>检查 RAID 阵列的状态</em></p>
<p><strong>3. 格式化 RAID 设备</strong></p>
<p>如本系列<a href="https://linux.cn/article-7187-1.html" target="_blank" rel="external">第四讲</a>所介绍的，按照你的需求/要求采用某种文件系统格式化你的设备。</p>
<p><strong>4. 监控 RAID 阵列服务</strong></p>
<p>让监控服务时刻监视你的 RAID 阵列。把<code># mdadm --detail --scan</code>命令输出结果添加到 <code>/etc/mdadm/mdadm.conf</code>(Debian及其衍生版)或者<code>/etc/mdadm.conf</code>(Cent0S/openSUSE)，如下。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">detail</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">scan</span></span><br></pre></td></tr></table></figure>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222354jdhnm2wyasnzhmv3.png" alt="监控 RAID 阵列"></p>
<p><em>监控 RAID 阵列</em></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mdadm --assemble --scan     [Assemble the array]</span></span><br></pre></td></tr></table></figure>
<p>为了确保服务能够开机启动，需要以 root 权限运行以下命令。</p>
<p><strong>Debian 及其衍生版</strong></p>
<p>Debian 及其衍生版能够通过下面步骤使服务默认开机启动：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">update</span>-rc.<span class="keyword">d</span> mdadm defaults</span><br></pre></td></tr></table></figure>
<p>在 <code>/etc/default/mdadm</code> 文件中添加下面这一行</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">AUTOSTART</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><strong>CentOS 和 openSUSE(systemd-based)</strong></p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># systemctl start mdmonitor# systemctl enable mdmonitor</span></span><br></pre></td></tr></table></figure>
<p><strong>CentOS 和 openSUSE(SysVinit-based)</strong></p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># service mdmonitor start# chkconfig mdmonitor on</span></span><br></pre></td></tr></table></figure>
<p><strong>5. 检查RAID磁盘故障</strong></p>
<p>在支持冗余的的 RAID 级别中，在需要时会替换故障的驱动器。当磁盘阵列中的设备出现故障时，仅当存在我们第一次创建阵列时预留的备用设备时，磁盘阵列会将自动启动重建。</p>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222400usjj5mzsxvwvql2n.png" alt="检查 RAID 故障磁盘"></p>
<p><em>检查 RAID 故障磁盘</em></p>
<p>否则，我们需要手动将一个额外的物理驱动器插入到我们的系统，并且运行。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mdadm <span class="regexp">/dev/m</span>d0 --add <span class="regexp">/dev/</span>sdX1</span><br></pre></td></tr></table></figure>
<p>/dev/md0 是出现了问题的阵列，而 /dev/sdx1 是新添加的设备。</p>
<p><strong>6. 拆解一个工作阵列</strong></p>
<p>如果你需要使用工作阵列的设备创建一个新的阵列，你可能不得不去拆解已有工作阵列——(可选步骤)</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mdadm --stop /dev/md0                 #  Stop the array# mdadm --remove /dev/md0             # Remove the RAID device# mdadm --zero-superblock /dev/sdX1     # Overwrite the existing md superblock with zeroes</span></span><br></pre></td></tr></table></figure>
<p><strong>7. 设置邮件通知</strong></p>
<p>你可以配置一个用于发送通知的有效邮件地址或者系统账号(确保在 mdadm.conf 文件中有下面这一行)。——(可选步骤)</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MAILADDR</span> root</span><br></pre></td></tr></table></figure>
<p>在这种情况下，来自 RAID 后台监控程序所有的通知将会发送到你的本地 root 账号的邮件箱中。其中一个类似的通知如下。</p>
<p>说明：此次通知事件和第5步中的例子相关。此处一个设备被标志为错误，并且一个空闲的设备自动地被 mdadm 加入到阵列。我们用完了所有“健康的”空闲设备，因此我们得到了通知。</p>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222403ao1rbkmzdh5iplm9.png" alt="RAID 监控通知"></p>
<p><em>RAID 监控通知</em></p>
<h4 id="了解-RAID-级别"><a href="#了解-RAID-级别" class="headerlink" title="了解 RAID 级别"></a>了解 RAID 级别</h4><p><strong>RAID 0</strong></p>
<p>阵列总大小是最小分区大小的 n 倍，n 是阵列中独立磁盘的个数(你至少需要两个驱动器/磁盘)。运行下面命令，使用 /dev/sdb1 和 /dev/sdc1 分区组装一个 RAID 0 阵列。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">verbose</span> <span class="comment">/dev/md0</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">level=stripe</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raid</span><span class="literal">-</span><span class="comment">devices=2</span> <span class="comment">/dev/sdb1</span> <span class="comment">/dev/sdc1</span></span><br></pre></td></tr></table></figure>
<p>常见用途：用于支持性能比容错更重要的实时应用程序的设置</p>
<p><strong>RAID 1 (又名镜像)</strong></p>
<p>阵列总大小等于最小分区大小(你至少需要两个驱动器/磁盘)。运行下面命令，使用 /dev/sdb1 和 /dev/sdc1 分区组装一个 RAID 1 阵列。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">verbose</span> <span class="comment">/dev/md0</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">level=1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raid</span><span class="literal">-</span><span class="comment">devices=2</span> <span class="comment">/dev/sdb1</span> <span class="comment">/dev/sdc1</span></span><br></pre></td></tr></table></figure>
<p>常见用途：操作系统的安装或者重要的子文件夹，例如 /home</p>
<p><strong>RAID 5 (又名奇偶校验码盘)</strong></p>
<p>阵列总大小将是最小分区大小的 (n-1) 倍。所减少的大小用于奇偶校验(冗余)计算(你至少需要3个驱动器/磁盘)。</p>
<p>说明：你可以指定一个空闲设备 (/dev/sde1) 替换问题出现时的故障部分(分区)。运行下面命令，使用 /dev/sdb1, /dev/sdc1, /dev/sdd1，/dev/sde1 组装一个 RAID 5 阵列，其中 /dev/sde1 作为空闲分区。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">verbose</span> <span class="comment">/dev/md0</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">level=5</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raid</span><span class="literal">-</span><span class="comment">devices=3</span> <span class="comment">/dev/sdb1</span> <span class="comment">/dev/sdc1</span> <span class="comment">/dev/sdd1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">spare</span><span class="literal">-</span><span class="comment">devices=1</span> <span class="comment">/dev/sde1</span></span><br></pre></td></tr></table></figure>
<p>常见用途：Web 和文件服务</p>
<p><strong>RAID 6 (又名双重奇偶校验码盘)</strong></p>
<p>阵列总大小为(n<em>s)-2</em>s，其中n为阵列中独立磁盘的个数，s为最小磁盘大小。</p>
<p>说明：你可以指定一个空闲分区(在这个例子为 /dev/sdf1)替换问题出现时的故障部分(分区)。</p>
<p>运行下面命令，使用 /dev/sdb1, /dev/sdc1, /dev/sdd1, /dev/sde1 和 /dev/sdf1 组装 RAID 6 阵列，其中 /dev/sdf1 作为空闲分区。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mdadm --create --verbose <span class="regexp">/dev/m</span>d0 --level=<span class="number">6</span> --raid-devices=<span class="number">4</span> <span class="regexp">/dev/</span>sdb1 <span class="regexp">/dev/</span>sdc1 <span class="regexp">/dev/</span>sdd1 <span class="regexp">/dev/</span>sde --spare-devices=<span class="number">1</span> <span class="regexp">/dev/</span>sdf1</span><br></pre></td></tr></table></figure>
<p>常见用途：大容量、高可用性要求的文件服务器和备份服务器。</p>
<p><strong>RAID 1+0 (又名镜像条带)</strong></p>
<p>因为 RAID 1+0 是 RAID 0 和 RAID 1 的组合，所以阵列总大小是基于两者的公式计算的。首先，计算每一个镜像的大小，然后再计算条带的大小。</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span> <span class="comment">mdadm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">create</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">verbose</span> <span class="comment">/dev/md0</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">level=10</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raid</span><span class="literal">-</span><span class="comment">devices=4</span> <span class="comment">/dev/sd</span><span class="title">[</span><span class="comment">b</span><span class="literal">-</span><span class="comment">e</span><span class="title">]</span><span class="comment">1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">spare</span><span class="literal">-</span><span class="comment">devices=1</span> <span class="comment">/dev/sdf1</span></span><br></pre></td></tr></table></figure>
<p>常见用途：需要快速 IO 操作的数据库和应用服务器</p>
<h4 id="创建和管理系统备份"><a href="#创建和管理系统备份" class="headerlink" title="创建和管理系统备份"></a>创建和管理系统备份</h4><p>记住， RAID 其所有的价值不是在于备份的替换者！在黑板上写上1000次，如果你需要的话，但无论何时一定要记住它。在我们开始前，我们必须注意的是，没有一个放之四海皆准的针对所有系统备份的解决方案，但这里有一些东西，是你在规划一个备份策略时需要考虑的。</p>
<ul>
<li>你的系统将用于什么？(桌面或者服务器？如果系统是应用于后者，那么最重要的服务是什么？哪个配置是痛点？)</li>
<li>你每隔多久备份你的系统？</li>
<li>你需要备份的数据是什么(比如文件/文件夹/数据库转储)？你还可以考虑是否需要备份大型文件(比如音频和视频文件)。</li>
<li>这些备份将会存储在哪里(物理位置和媒体)？</li>
</ul>
<p><strong>备份你的数据</strong></p>
<p>方法1：使用 dd 命令备份整个磁盘。你可以在任意时间点通过创建一个准确的镜像来备份一整个硬盘或者是分区。注意当设备是离线时，这种方法效果最好，也就是说它没有被挂载并且没有任何进程的 I/O 操作访问它。</p>
<p>这种备份方法的缺点是镜像将具有和磁盘或分区一样的大小，即使实际数据占用的是一个很小的比例。比如，如果你想要为只使用了10%的20GB的分区创建镜像，那么镜像文件将仍旧是20GB。换句话来讲，它不仅包含了备份的实际数据，而且也包含了整个分区。如果你想完整备份你的设备，那么你可以考虑使用这个方法。</p>
<p><strong>从现有的设备创建一个镜像文件</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>sda of=<span class="regexp">/system_images/</span>sda.img或者--------------------- 可选地，你可以压缩镜像文件 -------------------# dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>sda | gzip -c &gt; <span class="regexp">/system_images/</span>sda.img.gz</span><br></pre></td></tr></table></figure>
<p><strong>从镜像文件恢复备份</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dd <span class="keyword">if</span>=<span class="regexp">/system_images/</span>sda.img of=<span class="regexp">/dev/</span>sda或者--------------------- 根据你创建镜像文件时的选择(译者注:比如压缩) ----------------# gzip -dc <span class="regexp">/system_images/</span>sda.img.gz | dd of=<span class="regexp">/dev/</span>sda</span><br></pre></td></tr></table></figure>
<p>方法2：使用 tar 命令备份确定的文件/文件夹——已经在本系列<a href="https://linux.cn/article-7171-1.html" target="_blank" rel="external">第三讲</a>中讲了。如果你想要备份指定的文件/文件夹(配置文件，用户主目录等等)，你可以使用这种方法。</p>
<p>方法3：使用 rsync 命令同步文件。rsync 是一种多功能远程（和本地）文件复制工具。如果你想要从网络设备备份或同步文件，rsync 是一种选择。</p>
<p>无论是你是正在同步两个本地文件夹还是本地 &lt; — &gt; 挂载在本地文件系统的远程文件夹，其基本语法是一样的。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># rsync -av source_directory destination_directory</span></span><br></pre></td></tr></table></figure>
<p>在这里，-a 递归遍历子目录(如果它们存在的话)，维持符号链接、时间戳、权限以及原本的属主/属组，-v 显示详细过程。</p>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222405x8a94kkqyffay9sp.png" alt="rsync 同步文件"></p>
<p><em>rsync 同步文件</em></p>
<p>除此之外，如果你想增加在网络上传输数据的安全性，你可以通过 ssh 协议使用 rsync。</p>
<p><strong>通过 ssh 同步本地到远程文件夹</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync -avzhe ssh backups root<span class="doctag">@remote</span>_host:/remote_directory/</span></span><br></pre></td></tr></table></figure>
<p>这个示例，本地主机上的 backups 文件夹将与远程主机上的 /root/remote_directory 的内容同步。</p>
<p>在这里，-h 选项以易读的格式显示文件的大小，-e 标志用于表示一个 ssh 连接。</p>
<p><img src="https://dn-linuxcn.qbox.me/data/attachment/album/201604/15/222410w0r0bcclcgtgc3cf.png" alt="rsync 同步远程文件"></p>
<p><em>rsync 同步远程文件</em></p>
<p><strong>通过ssh同步远程到本地文件夹</strong></p>
<p>在这种情况下，交换前面示例中的 source 和 destination 文件夹。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync -avzhe ssh root<span class="doctag">@remote</span>_host:/remote_directory/ backups</span></span><br></pre></td></tr></table></figure>
<p>请注意这些只是 rsync 用法的三个示例而已(你可能遇到的最常见的情形)。对于更多有关 rsync 命令的示例和用法 ，你可以查看下面的文章。</p>
<ul>
<li><a href="http://www.tecmint.com/rsync-local-remote-file-synchronization-commands/" target="_blank" rel="external">在 Linux 下同步文件的10个 rsync命令</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="nimord.github.io/2016/07/29/lfcs-06/" data-id="cix2nw1o8000724awbruymqy9" class="article-share-link">分享到</a><div class="tags"><a href="/tags/lfcs/">lfcs</a></div><div class="post-nav"><a href="/2016/07/29/lfcs-07/" class="pre">LFCS 07：通过 SysVinit、Systemd 和 Upstart 管理系统自启动进程和服务</a><a href="/2016/07/29/lfcs-05/" class="next">LFCS 05：如何在 Linux 中挂载/卸载本地文件系统和网络文件系统（Samba 和 NFS）</a></div><div id="disqus_thread"><script>var disqus_shortname = 'qiankun';
var disqus_identifier = '2016/07/29/lfcs-06/';
var disqus_title = 'LFCS 06：组装分区为RAID设备——创建和管理系统备份';
var disqus_url = 'nimord.github.io/2016/07/29/lfcs-06/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//qiankun.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/lfcs/" style="font-size: 15px;">lfcs</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-12/">LFCS 12：如何使用 Linux 的帮助文档和工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-11/">LFCS 11：如何使用命令 vgcreate、lvcreate 和 lvextend 管理和创建 LVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-10/">LFCS 10：学习简单的 Shell 脚本编程和文件系统故障排除</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-09/">LFCS 09：使用 Yum/RPM/Apt/Dpkg/Aptitude 进行 Linux 软件包管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-08/">LFCS 08：管理用户和用户组、文件权限和属性以及启用账户 sudo 访问权限</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-07/">LFCS 07：通过 SysVinit、Systemd 和 Upstart 管理系统自启动进程和服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-06/">LFCS 06：组装分区为RAID设备——创建和管理系统备份</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-05/">LFCS 05：如何在 Linux 中挂载/卸载本地文件系统和网络文件系统（Samba 和 NFS）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-04/">LFCS 04：对存储设备分区、格式化文件系统和配置交换分区</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/lfcs-03/">LFCS 03：归档/压缩文件及目录、设置文件属性和搜索文件</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//qiankun.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">ChaoS.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>